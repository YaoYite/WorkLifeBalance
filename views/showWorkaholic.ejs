<% include partials/header %>
<header class="masthead" style="background-image: url('/img/track-min.jpeg')">
      <div class="overlay"></div>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <div class="page-heading">
              <h1>The detail infomation of the person</h1>
              <span class="subheading">Personal information and tracking records</span>
            </div
          </div>
        </div>
      </div>
    </header>
          <% var familysum = 0;  %> 
          <% var familycount = 0;  %> 
          <% workaholic.dailys.forEach(function(daily){ %>
          <% familysum += daily.family;  %> 
          <% familycount += 1;  %> 
          <% }); %>
          <% var familyavg = familysum/familycount  %>
          
          <% var hobbysum = 0;  %> 
          <% var hobbycount = 0;  %> 
          <% workaholic.dailys.forEach(function(daily){ %>
          <% hobbysum += daily.hobbies;  %> 
          <% hobbycount += 1;  %> 
          <% }); %>
          <% var hobbyavg = hobbysum/hobbycount  %>
          
  <div class="container">
    <div class="row">
      <div class="col-sm-6">     
          <p>Name: <%= workaholic.name %></p>
          <p>Email: <%= workaholic.email %></p>
          <p>Gender: <%=  workaholic.gender %></p>
          <p>Age: <%= workaholic.age %></p>
          <p>Relation: <%= workaholic.relation %></p>
          <p>Occupation: <%= workaholic.occupation %></p>
          <p>Hobby: <%= workaholic.hobby %></p>
          <br>
          <% if(currentUser && workaholic.user.id.equals(currentUser._id)){ %>
          <a class="btn btn-xs btn-warning" href="/workaholics/<%= workaholic._id %>/edit">Edit workaholic</a>
          <form id="delete-form" action="/workaholics/<%= workaholic._id %>?_method=DELETE" method="POST">
              <button class="btn btn-xs btn-danger">Delete workaholic</button>
          </form>
          <% }%>
          
          <p>      </p>
          <br>
      </div>
      <div class="col-sm-6">
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script type="text/javascript">
          google.charts.load('current', {'packages':['corechart', 'bar']});
          google.charts.setOnLoadCallback(drawStuff);
    
          function drawStuff() {
    
            var button = document.getElementById('change-chart');
            var chartDiv = document.getElementById('chart_div');
            
            var data = google.visualization.arrayToDataTable([
              ['Spent time daily', 'Family', 'Hobby'],
              ['Average Australian', 6, 2],
              ['This person', <%= familyavg %>, <%= hobbyavg %>],
            ]);
    
            var materialOptions = {
              width: 900,
              chart: {
                title: 'Comparing with average Australian',
                subtitle: 'Family time on the left, Hobby time on the right'
              },
              series: {
                0: { axis: 'family' }, // Bind series 0 to an axis named 'distance'.
                1: { axis: 'hobby' } // Bind series 1 to an axis named 'brightness'.
              },
              axes: {
                y: {
                  family: {label: 'hours'}, // Left y-axis.
                  hobby: {side: 'right', label: 'hours'} // Right y-axis.
                }
              }
            };
    
            var classicOptions = {
              width: 900,
              series: {
                0: {targetAxisIndex: 0},
                1: {targetAxisIndex: 1}
              },
              title: 'Comparing with average Australian - Family time on the left, Hobby time on the right',
              vAxes: {
                // Adds titles to each axis.
                0: {title: 'hour'},
                1: {title: 'hour'}
              }
            };
    
            function drawMaterialChart() {
              var materialChart = new google.charts.Bar(chartDiv);
              materialChart.draw(data, google.charts.Bar.convertOptions(materialOptions));
              button.innerText = 'Change to Classic';
              button.onclick = drawClassicChart;
            }
    
            function drawClassicChart() {
              var classicChart = new google.visualization.ColumnChart(chartDiv);
              classicChart.draw(data, classicOptions);
              button.innerText = 'Change to Material';
              button.onclick = drawMaterialChart;
            }
    
            drawMaterialChart();
        };
        </script>
    
        <button id="change-chart">Change to Classic</button>
        <br><br>
        <div id="chart_div" style="width: 500px; height: 400px;"></div>
      </div>
    </div>
  </div>
  
  <hr>
    
    <div class="container">
          <div class="row">
            <div class="col-sm-12">  
            <a href = "/workaholics/<%= workaholic._id %>/dailys/new" class="btn btn-success">Add new daily tracks</a>
    <br>
        <p><%= workaholic.name %> spend <%= familyavg %> hours average everyday on family</p>
        <p><%= workaholic.name %> spend <%= hobbyavg %> hours average everyday on family</p>
        <hr>
          <table class="display" id="example" style="width:100%">
        <thead>
            <tr>
                <th>Date</th>
                <th>Family (hour)</th>
                <th>Hobby (hour)</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
          <% workaholic.dailys.forEach(function(daily){ %>
            <tr>
                <td><%= daily.date %></td>
                <td><%= daily.family %></td>
                <td><%= daily.hobbies %></td>
                <td>
                    <!--<a type = "button" class="btn btn-info" href="/workaholics/<%=workaholic._id %>/dailys/<%=daily._id %>/show">Detail</a>-->
                    <a type = "button" class="btn btn-warning " href="/workaholics/<%=workaholic._id %>/dailys/<%=daily._id %>/edit">Edit</a>
                    <form id="delete-form" action="/workaholics/<%=workaholic._id %>/dailys/<%=daily._id %>?_method=DELETE" method="POST">
                          <input type="submit" value = "Delete" type = "button" class="btn btn-danger">
                    </form>
                </td>
            </tr>
            <% }) %>
            </tbody>
        <tfoot>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </tfoot>
    </table>
          
          
        </div>
      </div>
    </div>
    
<% include partials/footer %>