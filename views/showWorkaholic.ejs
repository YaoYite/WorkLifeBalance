<% include partials/header %>
<header class="masthead" style="background-image: url('/img/track-min.jpeg')">
      <div class="overlay"></div>
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-md-10 mx-auto">
            <div class="page-heading">
              <h1>The records of <%= workaholic.name %></h1>
              <!--<span class="subheading">Personal information and tracking records</span>-->
            </div>
      </div>
    </header>
          <% var familysum = 0;  %> 
          <% var familycount = 0;  %> 
          <% workaholic.dailys.forEach(function(daily){ %>
          <% familysum += daily.family;  %> 
          <% familycount += 1;  %> 
          <% }); %>
          <% var familyavg = familysum/familycount;  %>
          <% var familyavg = familyavg.toFixed(2);  %>
          
          <% var hobbysum = 0;  %> 
          <% var hobbycount = 0;  %> 
          <% workaholic.dailys.forEach(function(daily){ %>
          <% hobbysum += daily.hobbies;  %> 
          <% hobbycount += 1;  %> 
          <% }); %>
          <% var hobbyavg = hobbysum/hobbycount;  %>
          <% var hobbyavg = hobbyavg.toFixed(2);  %>

    <div class="container" id = "1">
          <div class="row">
            <div class="col-sm-12">  
            <a href = "/workaholics/<%= workaholic._id %>/dailys/new" class="btn btn-success">Add new daily tracks</a>
    <br>
        <p><%= workaholic.name %> spend <%= familyavg %> hours average everyday on family</p>
        <p><%= workaholic.name %> spend <%= hobbyavg %> hours average everyday on hobby</p>
        <hr>
          <table class="display" id="example" style="width:100%">
        <thead>
            <tr>
                <th>Date</th>
                <th>Family (hour)</th>
                <th>Hobby (hour)</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
          <% workaholic.dailys.forEach(function(daily){ %>
            <tr>
                <td><%= daily.date %></td>
                <td><%= daily.family.toFixed(2) %></td>
                <td><%= daily.hobbies.toFixed(2) %></td>
                <td>
                    <!--<a type = "button" class="btn btn-info" href="/workaholics/<%=workaholic._id %>/dailys/<%=daily._id %>/show">Detail</a>-->
                    <a type = "button" class="btn btn-warning " href="/workaholics/<%=workaholic._id %>/dailys/<%=daily._id %>/edit">Edit</a>
                    <form id="delete-form" action="/workaholics/<%=workaholic._id %>/dailys/<%=daily._id %>?_method=DELETE" method="POST">
                          <input type="submit" value = "Delete" type = "button" class="btn btn-danger">
                    </form>
                </td>
            </tr>
            <% }) %>
            </tbody>
        <tfoot>
            <tr>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
            </tr>
        </tfoot>
    </table>
        </div>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
          <script type="text/javascript">
            google.charts.load("current", {packages:['corechart']});
            google.charts.setOnLoadCallback(drawChart);
            function drawChart() {
              var data = google.visualization.arrayToDataTable([
                ["Element", "Average Hours per day", { role: "style" } ],
                ["Australian average family time per day", 4.16, "green"],
                ["This person's average family time per day", <%= familyavg %>, "green"],
                ["Australian average Hobby time per day", 2.79, "blue"],
                ["This person's average Hobby time per day", <%= hobbyavg %>, "blue"]
              ]);
        
              var view = new google.visualization.DataView(data);
              view.setColumns([0, 1,
                               { calc: "stringify",
                                 sourceColumn: 1,
                                 type: "string",
                                 role: "annotation" },
                               2]);
        
              var options = {
                title: "Comparing with Australian average, in hours/day",
                width: 730,
                height: 550,
                bar: {groupWidth: "95%"},
                legend: { position: "none" },
              };
              var chart = new google.visualization.ColumnChart(document.getElementById("columnchart_values"));
              chart.draw(view, options);
          }
          </script>
        <div class="col-sm-12" id="columnchart_values" style="width: 500px; height: 600px;"></div>
        <hr>
        <div class="col-sm-12">     
          <% if(currentUser && workaholic.user.id.equals(currentUser._id)){ %>
          <a class="btn btn-xs btn-info" href="/workaholics/<%= workaholic._id %>/detail">The detail of <%= workaholic.name %> Profile</a>
          <a class="btn btn-xs btn-warning" href="/workaholics/<%= workaholic._id %>/edit">Edit <%= workaholic.name %> Profile</a>
          <form id="delete-form" action="/workaholics/<%= workaholic._id %>?_method=DELETE" method="POST">
              <button class="btn btn-xs btn-danger">Delete <%= workaholic.name %> Profile</button>
          </form>
          <% }%>
          <p>      </p>
          <br>
        </div>
      </div>
    </div>
<!--======================================================================================================================-->
<!--trend chart-->
<div class="container">
<script src="https://d3js.org/d3.v3.min.js"></script>
<script>
var data = <%= workaholic.dailys %>;

</script>
<p><%= workaholic.dailys %></p>
</div>
<!--======================================================================================================================-->
    
    
<% include partials/footer %>